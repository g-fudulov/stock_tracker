{% extends 'base.html' %}
{% load static %}
{% block page_content %}
    <h1>Portfolio</h1>
    <p class="portfolio total-value">Value: &dollar;</p>
    <p>Realised P&L: &dollar;{{ object.realised_pnl }}</p>
    <a href="{% url 'sales_details' object.owner_id object.pk %}">Sales History</a>
    <a href="{% url 'buys_details' object.owner_id object.pk %}">Buys History</a>
    <hr>
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
    <h3>Investments</h3>
        {% for item in object.portfolioitem_set.all %}
            <div class="investment-container">
                <div style="border: 1px solid cadetblue;">
                    <p>{{ item.stock.name }}</p>
                    <p id="{{ item.stock.symbol }} avg_price">Average Purchase Price: &dollar;{{ item.average_purchase_price }}</p>
                    <p id="{{ item.stock.symbol }} shares">Shares: {{ item.quantity }}</p>
                </div>
                <button id="{{ item.stock.symbol }}btn" class="refresh btn btn-primary">Refresh Price</button>
                <div>
                    <p id="{{ item.stock.symbol }} price">Current Price: &dollar;
                        <span class="{{ item.stock.symbol }} current-price"></span>
                    </p>
                </div>
                <button id="{{ item.stock.symbol }} pnl-btn" class="{{ item.stock.symbol }} pnl btn btn-primary">Calculate P&L</button>
                <div>
                    <p id="pnl text">P&L:
                        <span id="{{ item.stock.symbol }} pnl-percentage" class="{{ item.stock.symbol }} current-pnl">-%</span>
                    </p>
                </div>
                <a href="{% url 'buy_stock' object.pk item.stock.symbol %}" class="btn btn-primary">Buy</a>
                <a href="{% url 'sell_stock' object.pk item.stock.symbol %}" class="btn btn-primary">Sell</a>
                <a href="{% url 'remove_stock' object.pk item.stock.symbol %}" class="btn btn-primary">Remove</a>
            </div>
        {% empty %}
            <p>No investments!</p>
        {% endfor %}
    </div>
    <a href="{% url 'add_stock' request.user.profile.portfolio.pk %}">Add New Position</a>
    <script src="{% static 'js/refreshQuotes.js' %}"></script>
    <script src="{% static 'js/calculatePnl.js' %}"></script>
{% endblock %}